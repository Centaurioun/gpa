2001-01-31  Bernhard Herzog  <bh@intevation.de>

	* keygenwizard.c (gpa_keygen_wizard_destroy):
	(gpa_keygen_wizard_run): Add a destroy event handler and quit the
	recursive main loop there.
	(gpa_keygen_wizard_close): Instead of quitting the main loop,
	destroy the dialog window. Also, use the correct prototype.

	* keysigndlg.c (gpa_key_sign_run_dialog): Make sure dialog.result
	is set to FALSE by default.

2001-01-30  Bernhard Herzog  <bh@intevation.de>

	* keysigndlg.c (key_sign_destroy):
	(gpa_key_sign_run_dialog): Add a destroy event handler and quit
	the recursive main loop there.
	(key_sign_cancel):
	(key_sign_ok): Instead of quitting the main loop, destroy the
	dialog window.
	(key_sign_delete): Removed because the default handler does
	exactly what we need now.
	(GPAKeySignDialog):
	(key_sign_ok): Remove the clist_keys field completely and don't
	access it in key_sign_ok.

	* ownertrustdlg.c (ownertrust_ok):
	(ownertrust_cancel): Fix comments

	* passphrasedlg.c (passphrase_destroy):
	(gpa_passphrase_run_dialog): Add a destroy event handler and quit
	the recursive main loop there.
	(passphrase_ok):
	(passphrase_cancel): Instead of quitting the main loop, destroy
	the dialog window.
	(passphrase_delete_event): Removed because the default handler
	does exactly what we need now.
	(gpa_passphrase_run_dialog): use gtk_window_set_modal to get a
	modal dialog and focus the password entry widget
	(GPAPassphraseDialog): Add the window field to pass the dialog
	window into the callbacks.

	* ownertrustdlg.c: Add comments
	(ownertrust_ok):
	(ownertrust_cancel): Destroy the dialog window
	(gpa_ownertrust_run_dialog):
	(ownertrust_destroy): Add a destroy event handler and quit the
	recursive main loop there.
	(ownertrust_delete_event): Removed because the default handler
	does exactly what we need now.
	(gpa_ownertrust_run_dialog): Use gpa_window_show_centered instead
	of gpa_widget_show and use gtk_window_set_modal to get a modal
	dialog

	* keyeditdlg.c (gpa_key_edit_dialog_run):
	(key_edit_destroy): Add a destroy event handler and quit the
	recursive main loop there.
	(key_edit_close): Destroy the dialog window. Quitting the mainloop
	is now handled in the destroy callback.
	(key_edit_delete_event): Removed because the default handler does
	exactly what we need now.

	* keyeditdlg.h: 
	* keyeditdlg.c: New files implementing the key edit dialog (still
	incomplete, though)

	* Makefile.am (gpa_SOURCES): Add the edit dialog files

	* keyring.c (toolbar_edit_key): Run the key edit dialog

2001-01-26  Bernhard Herzog  <bh@intevation.de>

	* keyring.c (keyring_editor_new): Initialize the status bar
	properly

	* gpa.c (gpa_update_default_key): If the default key is not set
	yet, set it to (an approximation of) gpg's default key.
	(gpa_determine_default_key): Make it static. It's better to use
	gpa_update_default_key now.
	* gpa.h: Update the prototypes accordingly.

	* gpa.c (main): 
	* keyring.c (keyring_editor_generate_key_simple): 
	(keyring_editor_generate_key_advanced): 
	Use gpa_update_default_key instead of gpa_determine_default_key

	* keyring.c (keyring_editor_mapped): Fix a typo
	(keyring_statusbar_new): new function to create a status bar
	showing the default key
	(GPAKeyringEditor): Add the labels of the status bar.
	(keyring_update_status_bar): New function to update the status bar
	whenever the default key changes.
	(keyring_editor_new): Add the status bar.

	* gpa.h: Add the prototypes for gpa_get_keyring_editor and
	gpa_get_filenamager

	* gpa.c (gpa_default_key_changed_marshal):
	(gpa_create_default_key_signal):
	(gpa_emit_default_key_changed): New functions to implement a user
	signal "gpa_default_key_changed" for GtkWindows that is emit on
	all toplevel windows whenever the default key changes.
	(main): Initialize the user signal 
	(gpa_set_default_key): Emit the new signal when the key changes.
	(gpa_get_keyring_editor): New function to return the keyring
	editor window
	(gpa_get_filenamager): New function to return the filemanager
	editor window

	* keyring.c (keyring_editor_new): Remove the close button.

2001-01-25  Bernhard Herzog  <bh@intevation.de>

	* filemenu.c: 
	* gtktools.c: 
	* helpmenu.c: 
	* keysmenu.c: 
	* optionsmenu.c: Replace all those silly _("") with ""

2001-01-25	Jan-Oliver Wagner <jan@intevation.de>

	* simple-gettext.c (get_string): removed  ISO-8859-1 to IBM-CP-850
	conversion (assuming .mo file is adequately encoded)

2001-01-24  Bernhard Herzog  <bh@intevation.de>

	* keyring.c (keyring_update_signatures_page): Don't list the self
	signaturs in simplified UI mode.

	* siglist.c: Add some comments

	* siglist.h: 
	* siglist.c (gpa_siglist_set_signatures): Add a key_id parameter
	to filter out signatures of a given key. Useful to hide the self
	signatures of keys.

	* keyring.c (keyring_editor_new): Make the scrollbars of the
	keylist appear automatically.
	(keyring_editor_new): Put the keylist and the details notebook
	into a paned window so that users can allocate the vertical space
	for the widgets. Clean up the code a bit, too.

	* Makefile.am (gpa_SOURCES):
	* siglist.h: 
	* siglist.c: New files implementing the list of signatures in the
	keying editor.

	* keyring.c (keyring_details_notebook): Add the signatures page
	(keyring_update_signatures_page): New function to update the
	signatures page
	(keyring_selection_update_widgets): Update the signatures page
	too.
	(GPAKeyringEditor): Add the signatures list widget

	* keylist.c: Remove some uneeded includes
	
	* keylist.c (keylist_fill_list): Try to keep the current selection
	if the new keep_selection parameter is TRUE.
	(gpa_keylist_update_list): Keep the current selection.

	* keyring.c (keylist_columns_detailed):
	(keylist_columns_brief): Put the name at the end.

	* keylist.c (gpa_keylist_update_list): Make all columns have the
	optimal width.
	(gpa_keylist_new): Use gpa_keylist_update_list to fill the keylist
	and create the title buttons, so that the columns havethe optimal
	width.

2001-01-23  Bernhard Herzog  <bh@intevation.de>

	* keyring.c (keyring_toolbar_new): Add buttons for brief and
	detailed listing.
	(keyring_set_brief_listing):
	(keyring_set_detailed_listing): New. Signal handlers for the diref
	and detailed listing buttons of the toolbar.
	(keylist_columns_detailed):
	(keylist_columns_brief): Definitions of the brief and detailed key
	listing.
	(keyring_editor_new): Use keylist_columns_brief to initialize the
	key list

	(add_details_row):
	(keyring_details_notebook):
	(keyring_update_details_page): Turn the fingerprint label in the
	details notebook into an uneditable entry field so that users can
	copy and paste the fingerprint. To that end add a new parameter to
	add_details_row to indicate whether a label or entry is to be
	created.

	* keylist.c (keylist_fill_column_titles): Set the first
	keylist->ncolumns to visible.

2001-01-23	Jan-Oliver Wagner <jan@intevation.de>

	* simple-gettext.c: (new) "simple gettext method for
	Windows (copied from gnupg
	* Makefile.am: added simple-gettext

2001-01-23  Bernhard Herzog  <bh@intevation.de>

	* Makefile.am (gpa_SOURCES): Add the keylist files.

	* keylist.h: 
	* keylist.c: New files implementing the key list of the key ring
	editor.

	* keyring.c (keyring_editor_new):
	(keyring_editor_edit_trust):
	(keyring_editor_delete):
	(keyring_editor_sign):
	(keyring_editor_export): replace the CList of the keys with the
	keylist of keylist.c and modify all functions that use it to use
	the appropriate functions of keylist.c

	(keyring_editor_has_selection):
	(keyring_editor_has_single_selection):
	(keyring_editor_fill_keylist): 
	(keyring_editor_current_key_id): 
	(keyring_editor_current_key): 
	These function are now just frontends for the corresponding
	functions in keylist.c

2001-01-23	Jan-Oliver Wagner	<jan@intevation.de>

	* w32reg: new module copied from gnupg
	Access to Windows Registry
	* Makefile.am: added w32reg
	* gpa.c (main): now reads from Registry under Windows

2001-01-22  Bernhard Herzog  <bh@intevation.de>

	* keyring.c (keyring_editor_delete): Ask for confirmation before
	deleting keys.

2001-01-19  Bernhard Herzog  <bh@intevation.de>

	* keyring.c (keyring_editor_can_sign): Check whether the default
	has already signed the selected key and return FALSE in that case.
	(keyring_editor_current_key_id): New function that returns the id
	of the currently selected key.

	* gpa.c (main): Read the gtkrc file
	* Makefile.am: Add the gtkrc file
	* gtkrc: New file with GTK style defaults

	* keyring.c (keyring_editor_selection_changed):
	(keyring_editor_end_selection):
	(keyring_editor_fill_keylist):
	(keyring_editor_menubar_new): make them static

	(add_selection_sensitive_widget): Add the callback as a new
	parameter.
	(GPA_SENSITIVE_BUTTON): Get rid of this widget and use
	add_selection_sensitive_widget.

	(keyring_editor_new): Add a notebook showing details of the
	selected key and a toolbar at the top which replaces the buttons
	at the bottom
	(GPAKeyringEditor): Add three new fields for the labels of the
	details view.

	(keyring_toolbar_new): New function to create the new toolbar
	(toolbar_import_keys):
	(toolbar_export_key):
	(toolbar_sign_key):
	(toolbar_remove_key):
	(toolbar_edit_key): Signal handlers for the toolbar.

	(add_details_row):
	(keyring_details_notebook):
	(keyring_update_details_page): New functions to create and update
	the new details notebook.

	(keyring_editor_current_key): New function to return the currently
	selected key.

	(keyring_selection_update_widgets): New function that bundles all
	the updates that have to happen when the selection changes. Change
	the relevant signal handlers to use it.

	(keyring_editor_fill_keylist): The "show ownertrust" button is
	unavailable for now, so assume that it's not checked by default,
	just to make it work without the button.

	(keyring_editor_delete): Check for the existence of a private key
	and delete that first if it exists.

	* keyring.c: Substantial code reorganization

2001-01-18  Bernhard Herzog  <bh@intevation.de>

	* gpa.c (cmd_and_opt_values): 
	(opts):
	(main): 
	Rename the option simplified-ui to advanced-ui and
	reverse its meaning. The simplified UI is now the default.
	
	* keyring.c (keyring_editor_menubar_new): Add ... to "generate
	key" because it pops up a dialog

2001-01-17  Bernhard Herzog  <bh@intevation.de>

	* keyring.c (keyring_editor_can_sign): Change the condition.
	Signing is possible when at least one key is selected and there is
	a default key.

	(keyring_editor_generate_key_simple):
	(keyring_editor_generate_key_advanced): Update the default key and
	make sure all potentially sensitive widgets are updated.

	* keysigndlg.h (gpa_key_sign_run_dialog): Update the parameter
	list.
	
	* keysigndlg.c (gpa_key_sign_run_dialog): Remove the list box with
	the secret keys and the key_id paramter because we assume the
	selected keys are always signed with the default key. Also, in
	simplified ui mode, don't show the "sign locally" check box and
	set dialog.check_local to NULL.
	(key_sign_ok): Check whether dialog->check_local is NULL, i.e.
	whether the dialog was created in simplified ui mode, before
	retrieving the value. If it's NULL, set sign_type to normal.
	(struct _GPAKeySignDialog): remove the key_id field and update all
	users.

	* keyring.c (keyring_editor_sign): Change default sign type to
	normal which is probably better for the simplified UI mode. Also,
	private_key_id is the default key now, because it's not a retrun
	value of the key sign dialog anymore.

	* gpa.c (gpa_determine_default_key): New function to guess a
	useful default key.
	(main): Use gpa_determine_default_key to initialize the default
	key.

	* gtktools.c (gpa_window_error): Make the messenger parameter
	optional, i.e. it may be NULL now, so that gpa_callback can be
	used with NULL as calldata.

	* gpa.h:
	* gpa.c: Turn the definition of opt in gpa.h into an extern
	declaration and define it in gpa.c. Rename it to gpa_options. Fix
	all references to it. Introduce a typedef for the struct.

	* keysigndlg.h: 
	* keysigndlg.c (gpa_key_sign_run_dialog): Add the key to be signed
	to the parameter list and display its user id and fingerprint.

	* keyring.c (keyring_editor_generate_key_advanced): Do some error
	checking after generating the key pair.
	(keyring_editor_sign): Run the keysing dialog for each selected
	key separately

2001-01-16  Bernhard Herzog  <bh@intevation.de>

	* filemenu.c (file_sign_dialog): 
	* gpawidgets.c (gpa_secret_key_list_new): 
	* optionsmenu.c (gpa_loadOptionsSelect_ok):
	(gpa_saveOptionsSelect_ok):
	(options_key_set):
	(options_key): Use gpa_default_key and gpa_set_default_key instead
	of accessing global_defaultKey directly.
	
	* gpa.h: Add the two new functions gpa_default_key
	gpa_set_default_key

	* gpa.c (global_defaultKey):
	(gpa_default_key):
	(gpa_set_default_key): Turn global_defaultKey into a static
	varible default_key and introduce gpa_set_default_key and
	gpa_default_key to set and get its value

	* gpa.c (gpa_popupMenu_init):
	(global_popupMenu) Removed because they're no longer used.

	* gpa.h: Removed global_tempWindows

	* gpa.c: 
	* gpawindowkeeper.c: 
	Moved global_tempWindows to gpawindowkeeper as it's only used
	there, made it static and renamed it to tempWindows because it's
	not a global variable anymore.
	

2001-01-15  Bernhard Herzog  <bh@intevation.de>

	* keygenwizard.c (gpa_keygen_wizard_final_page): 
	Fix typo

	* keyring.c: Add and update comments
	(keyring_editor_can_sign): New function. Sensitivity callback for
	the sign key button.

	* keyring.c (keyring_editor_generate_key):
	(keyring_editor_generate_key_advanced): Renamed
	keyring_editor_generate_key to
	keyring_editor_generate_key_advanced.

	(keyring_editor_generate_key_simple): New function to call the key
	generation wizard

	(keyring_editor_generate_key): New function. Depending on the
	simple_ui flag call either keyring_editor_generate_key_advanced or
	keyring_editor_generate_key_simple

	(keyring_editor_mapped): New function. Signal handler handler for
	the map signal. If the simple_ui flag is set and no private key
	is in the keyring, suggest creating a new keypair.

	(keyring_editor_new): Connect to the map signal

	* gpawizard.c: 
	* gpawizard.h: 
	New files implementing a simple generic wizard interface

	* keygenwizard.h: 
	* keygenwizard.c: 
	New files implementing the key generation wizard

	* Makefile.am: Add the new files.

	* keygendlg.c (gpa_key_gen_run_dialog): Connect to delete-event
	and use the new gpa_window_show_centered function.

	* gtktools.h: Update the prototype of gpa_button_set_text and add
	the new message box functions

	* gtktools.c (gpa_button_set_text): Handle accelerators

	(message_box_delete): 
	(message_box_clicked): 
	(gpa_message_box_run): 

	New functions implementing a flexible message box with caller
	definable buttons.

	* gpa.h: Add the prototypes for gpa_simplified_ui and
	gpa_set_simplified_ui

	* gpa.c (opts): 
	(cmd_and_opt_values)
	Add a new option "simplified-ui" to turn on the simplified interface
	(gpa_simplified_ui): 
	(gpa_set_simplified_ui): 
	New functions to read and set the simplified ui flag

	(main): handle the simplified ui option in argument parsing

2001-01-11  Bernhard Herzog  <bh@intevation.de>

	* keysigndlg.c (gpa_key_sign_run_dialog):
	(key_sign_delete): Add signal handler for the delete-event signal.
	(gpa_key_sign_run_dialog): Use gpa_window_show_centered instead of
	gpa_widget_show

	* passphrasedlg.c 
	Add some comments
	(gpa_passphrase_run_dialog): The handler for the
	delete-event expected to be connected with gtk_signal_connect not
	with gtk_signal_connect_object.
	Use the new gpa_window_show_centered function
	(passphrase_delete_event): Return FALSE to indicate that the
	window is to be closed.

	* gtktools.c (gpa_window_show_centered): Make it actually work.

2001-01-10  Bernhard Herzog  <bh@intevation.de>

	* gtktools.c (gpa_window_show_centered): Removed the debug
	printf()s

2001-01-09  Bernhard Herzog  <bh@intevation.de>

	* gtktools.c (gpa_window_show_centered): New function. This is a
	better way to center windows and it should replace
	gpa_widget_set_centered one day.
	(gpa_window_error): Use the new gpa_window_show_centered instead
	of gpa_widget_show
	(gpa_button_set_text): New function to update the text of a button
	widget

	* gtktools.h: Add the two new function in gtktools.c

	* gpa.c (evalMouseClistFile): 
	(gpa_menubar_new):
	(delete_event): 
	(evalKeyClistFile): 

	Removed because they're no longer used

	* keyexportdlg.c (key_export_dialog_run): 
	get rid of the gpa_space_new () call

2001-01-05  Bernhard Herzog  <bh@intevation.de>

	* encryptdlg.c
	* encryptdlg.h
	* fileman.c
	* fileman.h
	* filesigndlg.c
	* filesigndlg.h
	* gpapastrings.c
	* gpapastrings.h
	* gpawidgets.c
	* gpawidgets.h
	* help.h
	* keyexportdlg.c
	* keyexportdlg.h
	* keygendlg.c
	* keygendlg.h
	* keyreceivedlg.c
	* keyreceivedlg.h
	* keyring.c
	* keyring.h
	* keysigndlg.c
	* keysigndlg.h
	* ownertrustdlg.c
	* ownertrustdlg.h
	* passphrasedlg.c
	* passphrasedlg.h
	* tipwindow.c
	new files

	* filemenu.c:
	* gpa.c: 
	* gpa.h: 
	* gtktools.c: 
	* gtktools.h: 
	* help.c: 
	* helpmenu.c: 
	* helpmenu.h: 
	* optionsmenu.c: 
	* optionsmenu.h: 

	A lot of changes and reorganization of the code. Much of the code
	is now in the new files.

	The reorganization has two goals: 
	
	1. Change the user interface to make the keyring editor the main
	window.

	2. Internal changes to make the code more object oriented and more
	maintainable.

	The changes are very extensive and touch practically all parts of
	the UI code.

	* Makefile.am: Added the new files

2000-09-01  Werner Koch  <wk@gnupg.org>

	* icons.c, icons.h: New.  Changed all other includes of icons.xpm
	to icons.h.
	* gpa.c (gpa_file_toolbar_new): Use this new function here.
	* gtktools.c (gpa_xpm_label_box): Ditto
	* keysmenu.c (getIconNameForOwnertrust): Replaces
	getIconForOwnertrust.  Chnaged all callers to provide a string now.
	
2000-08-17  Werner Koch  <wk@gnupg.org>

	* gpa.c (i18n_init,main): Fixed locale setting as suggested by
	Clive Lin.

2000-07-25 09:02:34  Werner Koch  (wk@habibti.openit.de)

  * gpa.c (gpa_windowTips_show): Moved from here to ...
  * help.c: ... here.  Complete rewrote to read the tips rom a file.
  (get_language): New.
  (gpa_tips.en, gpa_tips.de): New.

2000-06-28 17:23:03  Werner Koch  (wk@habibti.openit.de)

  * gpa.c:  Removed the --tooltip-kludge option, becuase the bug as
  been fixed meanwhile.
  * gtktools.c (gpa_widget_show): Removed it here too.

2000-06-28 15:32:07  Jan-Oliver Wagner (jan@intevation.de)

  * gtktools.c (gpa_widget_set_centered): fixed minimization bug
  * icons.xpm: replaced temporary icons and added ownertrust icons
  * keysmenu.c: added icon to button 'sign' in public keyring editor dialog,
  added ownertrust icons in keylist of public keyring editor dialog

2000-06-23 16:05:04  Jan-Oliver Wagner (jan@intevation.de)

  * keysmenu.c: added icon to the delete button in the
  public keyring editor dialog

2000-06-23 16:00:53  Jan-Oliver Wagner (jan@intevation.de)

  * icons.xpm: added a trashcan (taken from KDE)

2000-06-23 10:11:02  Jan-Oliver Wagner (jan@intevation.de)

  * icons.xpm: test icons for tool bar added

2000-06-23 10:10:44  Jan-Oliver Wagner (jan@intevation.de)

  * gpa.c: test icons for tool bar added, seldom actions removed from toolbar

2000-06-22 13:27:35  Jan-Oliver Wagner (jan@intevation.de)

  * icons.xpm: new file, contains icon xpm's. Just tempory until
  icons are treated in a more convenient way.

2000-06-20 16:45:31  Jan-Oliver Wagner (jan@intevation.de)

  * gpa.c: added toolbar for main window - experimental stage, but functioning

2000-05-25 17:54:29  Werner Koch  (wk@habibti.openit.de)

  * gpa.c (main): Add a call to gpapa_init

  New option --gpg-program.

2000-05-24 10:01:06  Werner Koch  (wk@habibti.openit.de)

  * gpa.c (gpa_menubar_new): Reformated menu list.
  * helpmenu.c (help_version): renamed to ...
  (help_about): .. this and implemented.

  * gpa.c, gpa.h (namesKeyservers): Replaced by ..
  (main): ... opt.keyserver_names and malloced array.
  * optionsmenu.c (options_keyserver): Put all keyservers into the list.

  * gtktools.c (gpa_widget_show): Kludge for Sawmill and Windowmaker.

2000-05-16 19:57:28  Werner Koch  (wk@habibti.openit.de)

  Ran "indent -gnu -sc" on all source files.

2000-05-04 18:40:08  Werner Koch  (wk@habibti.openit.de)

  * *.c: Moved all gpa_widget_set_centered() before the
  gtk_widget_show_all(), so that the windows are displayed correctly.

2000-05-02 19:57:29  Werner Koch  (wk@habibti.openit.de)

  * gpa.c, keymenu.c, filemenu.c: Removed libiberty header.
  * gpa.h: Included xmalloc header.


